<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Manutenção Anual</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-8">
  <div class="w-full max-w-3xl bg-white rounded-lg shadow-lg p-8">
    <h1 class="text-3xl font-bold text-blue-700 mb-6 text-center">Sistema de Manutenção Anual</h1>
    <form id="manutencaoForm" class="space-y-4 mb-8">
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Área</label>
        <input type="text" id="area" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Nome da Empresa</label>
        <input type="text" id="empresa" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      </div>
      <!-- ... (Cabeçalho e estilos iguais ao seu original) -->
<div>
  <label class="block text-gray-700 font-semibold mb-1">Observações</label>
  <textarea id="obs" rows="3" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
</div>

      <div>
        <label class="block text-gray-700 font-semibold mb-1">Datas das Visitas</label>
        <input type="date" id="dataVisita" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
        <button type="button" id="addData" class="mt-2 px-4 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">Adicionar Data</button>
        <div id="datasList" class="flex flex-wrap gap-2 mt-2"></div>
      </div>
      <button type="submit" class="w-full bg-green-600 text-white font-bold py-2 rounded hover:bg-green-700">Salvar Manutenção</button>
    </form>
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Manutenções Registradas</h2>
    <div id="manutencoesList" class="space-y-4"></div>
    <div class="flex flex-wrap gap-4 mb-6 justify-center">
      <button id="exportCSV" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 font-semibold">Exportar CSV</button>
      <button id="exportPDF" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 font-semibold">Exportar PDF</button>
      <button id="sendEmail" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 font-semibold">Enviar por E-mail</button>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const form = document.getElementById('manutencaoForm');
    const datasList = document.getElementById('datasList');
    const addDataBtn = document.getElementById('addData');
    const dataVisitaInput = document.getElementById('dataVisita');
    const manutencoesList = document.getElementById('manutencoesList');
    let datas = [];
    let editIndex = null; // Novo: controle de edição

    let manutencoes = [];

    addDataBtn.addEventListener('click', () => {
      if (dataVisitaInput.value) {
        datas.push(dataVisitaInput.value);
        renderDatas();
        dataVisitaInput.value = '';
      }
    });

    function renderDatas() {
      datasList.innerHTML = '';
      datas.forEach((data, idx) => {
        const span = document.createElement('span');
        span.className = 'bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm flex items-center';
        span.innerHTML = `${data} <button class='ml-2 text-red-500' onclick='removeData(${idx})' title='Remover'>&times;</button>`;
        datasList.appendChild(span);
      });
    }

    window.removeData = function(idx) {
      datas.splice(idx, 1);
      renderDatas();
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
     const obs = document.getElementById('obs').value;
if (!area || !empresa || datas.length === 0) {
  alert('Preencha todos os campos e adicione pelo menos uma data.');
  return;
}

if (editIndex !== null) {
  manutencoes[editIndex] = { area, empresa, obs, datas: [...datas] };
  editIndex = null;
} else {
  manutencoes.push({ area, empresa, obs, datas: [...datas] });
}

renderManutencoes();
form.reset();
datas = [];
renderDatas();
document.getElementById('obs').value = '';

    });

    function renderManutencoes() {
      manutencoesList.innerHTML = '';
      manutencoes.forEach((m, idx) => {
        const div = document.createElement('div');
        div.className = 'border border-gray-300 rounded p-4 bg-gray-50';
        div.innerHTML = `
  <div class='flex justify-between items-start'>
    <div>
      <p><span class='font-bold text-blue-700'>Área:</span> ${m.area}</p>
      <p><span class='font-bold text-blue-700'>Empresa:</span> ${m.empresa}</p>
      <p><span class='font-bold text-blue-700'>Observações:</span> ${m.obs || '—'}</p>
      <p><span class='font-bold text-blue-700'>Datas:</span> ${m.datas.map(d => `<span class='bg-green-100 text-green-700 px-2 py-1 rounded text-xs mr-1'>${d}</span>`).join('')}</p>
    </div>
    <div class="space-y-1 text-right">
      <button onclick='editarManutencao(${idx})' class='text-blue-600 font-semibold text-sm hover:underline'>Editar</button><br>
      <button onclick='removeManutencao(${idx})' class='text-red-600 font-semibold text-sm hover:underline'>Excluir</button>
    </div>
  </div>
`;

        manutencoesList.appendChild(div);
      });
    }

    window.removeManutencao = function(idx) {
      manutencoes.splice(idx, 1);
      renderManutencoes();
    }

    window.editarManutencao = function(idx) {
  const m = manutencoes[idx];
  document.getElementById('area').value = m.area;
  document.getElementById('empresa').value = m.empresa;
  document.getElementById('obs').value = m.obs || '';
  datas = [...m.datas];
  renderDatas();
  editIndex = idx;
  window.scrollTo({ top: 0, behavior: 'smooth' });
};


    // Função para exportar CSV
    document.getElementById('exportCSV').onclick = function() {
      if (manutencoes.length === 0) {
        alert('Nenhuma manutenção registrada para exportar.');
        return;
      }
      let csv = 'Área,Empresa,Datas\n';
      manutencoes.forEach(m => {
        csv += `"${m.area}","${m.empresa}","${m.datas.join('; ')}"\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'manutencoes.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    };

    // Função para exportar PDF
    document.getElementById('exportPDF').onclick = function() {
      if (manutencoes.length === 0) {
        alert('Nenhuma manutenção registrada para exportar.');
        return;
      }
      const doc = new window.jspdf.jsPDF();
      doc.setFontSize(16);
      doc.text('Manutenções Anuais', 10, 15);
      let y = 25;
      manutencoes.forEach((m, idx) => {
        doc.setFontSize(12);
        doc.text(`Área: ${m.area}`, 10, y);
        doc.text(`Empresa: ${m.empresa}`, 10, y + 7);
        doc.text(`Datas: ${m.datas.join(', ')}`, 10, y + 14);
        y += 25;
        if (y > 270) {
          doc.addPage();
          y = 15;
        }
      });
      doc.save('manutencoes.pdf');
    };

    // Função para enviar por e-mail
    document.getElementById('sendEmail').onclick = function() {
      if (manutencoes.length === 0) {
        alert('Nenhuma manutenção registrada para enviar.');
        return;
      }
      let body = 'Manutenções Anuais:%0D%0A%0D%0A';
      manutencoes.forEach(m => {
        body += `Área: ${m.area}%0D%0AEmpresa: ${m.empresa}%0D%0ADatas: ${m.datas.join(', ')}%0D%0A---%0D%0A`;
      });
      window.location.href = `mailto:?subject=Manutenções Anuais&body=${body}`;
    };
  </script>
</body>
</html>
